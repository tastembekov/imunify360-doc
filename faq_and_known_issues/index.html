<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FAQ and Known Issues | Documentation</title>
    <meta name="description" content="Imunify360 documentation">
    
    
    <link rel="preload" href="/assets/css/0.styles.911dbde5.css" as="style"><link rel="preload" href="/assets/js/app.bb2f7be1.js" as="script"><link rel="preload" href="/assets/js/10.bca94a56.js" as="script"><link rel="prefetch" href="/assets/js/11.1ac28269.js"><link rel="prefetch" href="/assets/js/12.6e226521.js"><link rel="prefetch" href="/assets/js/13.46ffe73a.js"><link rel="prefetch" href="/assets/js/14.8af932ce.js"><link rel="prefetch" href="/assets/js/15.be808a2e.js"><link rel="prefetch" href="/assets/js/16.d5374f4e.js"><link rel="prefetch" href="/assets/js/17.7f7dd8b2.js"><link rel="prefetch" href="/assets/js/18.2df70bc1.js"><link rel="prefetch" href="/assets/js/19.ac9bbcb3.js"><link rel="prefetch" href="/assets/js/20.a1f5b6d2.js"><link rel="prefetch" href="/assets/js/21.f96a9d22.js"><link rel="prefetch" href="/assets/js/22.29c32b96.js"><link rel="prefetch" href="/assets/js/23.20091f94.js"><link rel="prefetch" href="/assets/js/24.c7b1bafd.js"><link rel="prefetch" href="/assets/js/25.8d2071a2.js"><link rel="prefetch" href="/assets/js/26.b355be66.js"><link rel="prefetch" href="/assets/js/27.cab9d609.js"><link rel="prefetch" href="/assets/js/28.e992504f.js"><link rel="prefetch" href="/assets/js/29.5c0203f8.js"><link rel="prefetch" href="/assets/js/3.583977e2.js"><link rel="prefetch" href="/assets/js/30.3c699a2e.js"><link rel="prefetch" href="/assets/js/31.46e3c68b.js"><link rel="prefetch" href="/assets/js/32.7645454a.js"><link rel="prefetch" href="/assets/js/33.22054825.js"><link rel="prefetch" href="/assets/js/34.edeb6609.js"><link rel="prefetch" href="/assets/js/35.0ca91d25.js"><link rel="prefetch" href="/assets/js/36.ea707de3.js"><link rel="prefetch" href="/assets/js/37.cceb7d7a.js"><link rel="prefetch" href="/assets/js/4.da556001.js"><link rel="prefetch" href="/assets/js/5.8eedbc81.js"><link rel="prefetch" href="/assets/js/6.9781c443.js"><link rel="prefetch" href="/assets/js/7.65392d0f.js"><link rel="prefetch" href="/assets/js/8.3f6008df.js"><link rel="prefetch" href="/assets/js/9.2d72e62d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a71a1da2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.911dbde5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Documentation" class="logo"> <span class="site-name site-name--documentation can-hide">Documentation</span></a> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <div class="links" style="max-width:nullpx;"><a href="https://www.imunify360.com/trial" target="_blank" class="btn">
      Try Free
    </a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/faq_and_known_issues/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/faq_and_known_issues/" class="nav-link">Русский</a></li></ul></div></div></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/faq_and_known_issues/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/faq_and_known_issues/" class="nav-link">Русский</a></li></ul></div></div></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><div class="sidebar-heading open"><span>Contents</span> <!----></div> <ul class="sidebar-group-items"><li><a href="/introduction/" class="sidebar-link">Introduction</a></li><li><a href="/terminology/" class="sidebar-link">Terminology</a></li><li><a href="/billing/" class="sidebar-link">Billing</a></li><li><a href="/installation/" class="sidebar-link">Installation Guide</a></li><li><a href="/ids_integration/" class="sidebar-link">IDS Integrations</a></li><li><a href="/webshield/" class="sidebar-link">WebShield</a></li><li><a href="/backup_providers_integration/" class="sidebar-link">Backup Providers Integration</a></li><li><a href="/localization/" class="sidebar-link">Localization</a></li><li><a href="/dashboard/" class="sidebar-link">Imunify360 User Interface</a></li><li><a href="/hosting_panels_specific_settin/" class="sidebar-link">Hosting Panels Firewall Rulesets Specific Settings</a></li><li><a href="/config_file_description/" class="sidebar-link">Config File Description</a></li><li><a href="/command_line_interface/" class="sidebar-link">Command-line Interface</a></li><li><a href="/uninstall/" class="sidebar-link">Uninstall</a></li><li><a href="/faq_and_known_issues/" class="active sidebar-link">FAQ and Known Issues</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#common-questions" class="sidebar-link">Common Questions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_1-end-user-ip-is-blocked-and-i-do-not-know-why" class="sidebar-link">1. End user IP is blocked and I do not know why</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_2-could-i-disable-iptables-firewall-or-ossec-when-using-imunify360" class="sidebar-link">2. Could I disable IPtables (firewall) or OSSEC, when using Imunify360?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_3-does-imunify360-log-events-such-as-adding-or-removing-an-ip-to-from-the-gray-list" class="sidebar-link">3. Does Imunify360 log events such as adding or removing an IP to/from the Gray List?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_4-comodo-waf-has-a-lot-false-positive-and-trigger-the-csf-blocking-will-imunify360-improve-it" class="sidebar-link">4. Comodo WAF has a lot false positive and trigger the CSF blocking, will Imunify360 improve it?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_5-to-start-using-imunify360-we-need-to-know-which-information-is-sent-to-your-servers-could-you-please-give-us-some-more-information" class="sidebar-link">5. To start using Imunify360 we need to know which information is sent to your servers. Could you please give us some more information?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_6-no-valid-imunify360-license-found" class="sidebar-link">6. No valid Imunify360 License Found.</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_7-i-have-an-error-peewee-databaseerror-database-disk-image-is-malformed-what-should-i-do" class="sidebar-link">7. I have an error peewee.DatabaseError: database disk image is malformed. What should I do?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_8-why-does-my-cpanel-with-litespeed-and-owasp-modsecurity-rule-set-trigger-500-error-on-all-web-pages-after-installing-imunify360" class="sidebar-link">8. Why does my cPanel with LiteSpeed and OWASP ModSecurity rule set trigger 500 error on all web pages after installing Imunify360?</a></li><li class="sidebar-sub-header"><a href="/faq_and_known_issues/#_9-disabling-waf-rules-for-certain-countries" class="sidebar-link">9. Disabling WAF rules for certain countries.</a></li></ul></li></ul></li><li><a href="/whmcs_plugin/" class="sidebar-link">Imunify360 WHMCS Plugin</a></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Documentation:</span> <a href="/faq_and_known_issues/" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    FAQ and Known Issues
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/uninstall/" class="link prev">
      ←
    </a> <a href="/whmcs_plugin/" class="link">
      →
    </a></div></div> <div class="content"><h1 id="faq-and-known-issues"><a href="#faq-and-known-issues" aria-hidden="true" class="header-anchor">#</a> FAQ and Known Issues</h1> <h2 id="common-questions"><a href="#common-questions" aria-hidden="true" class="header-anchor">#</a> Common Questions</h2> <h3 id="_1-end-user-ip-is-blocked-and-i-do-not-know-why"><a href="#_1-end-user-ip-is-blocked-and-i-do-not-know-why" aria-hidden="true" class="header-anchor">#</a> 1. End user IP is blocked and I do not know why</h3> <p>If you use CSF, then try to find the IP in <a href="/ids_integration/#csf-integration">CSF</a> <span class="notranslate">Allow/Deny</span> Lists using their <a href="https://support.configserver.com/knowledgebase/category/support%20" target="_blank" rel="noopener noreferrer">documentation and support<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. If not, then do the following:</p> <ul><li><p>Go to cPanel Plugins section, choose Imunify360 and enter the <span class="notranslate">Incidents</span> page.</p></li> <li><p>Make sure that the IP checkbox at the top of the table is ticked. Enter proper IP or part of IP in the input field and click <em>Enter</em>.</p> <ul><li>If the IP was found, then follow instructions on <a href="/dashboard/#incidents">Incidents page</a> and perform the actions you need, like: add IP to the <span class="notranslate">White List</span> or disable the security rule that has detected this incident.</li></ul></li> <li><p>If the IP was not found on the Incidents page, then go to Firewall page and using the same way as in the previous step try to find proper IP in <span class="notranslate">Black List</span> or <span class="notranslate">Grey List</span>.</p> <ul><li>If the IP was found then follow this instruction for <span class="notranslate"><a href="/dashboard/#firewall">Grey List</a></span> or <span class="notranslate"><a href="/dashboard/#firewall">Black List</a></span> and move the IP to the <span class="notranslate">White List</span> or just remove from the <span class="notranslate">Black List</span> or <span class="notranslate">Grey List</span>.</li></ul></li></ul> <p>If nothing helps, then <a href="https://cloudlinux.zendesk.com/hc/requests/new" target="_blank" rel="noopener noreferrer">contact our support team<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="_2-could-i-disable-iptables-firewall-or-ossec-when-using-imunify360"><a href="#_2-could-i-disable-iptables-firewall-or-ossec-when-using-imunify360" aria-hidden="true" class="header-anchor">#</a> 2. Could I disable IPtables (firewall) or OSSEC, when using Imunify360?</h3> <p>No. Imunify360 will not be able to stop an attack without IPtables and will not be able to detect an attack without OSSEC.</p> <h3 id="_3-does-imunify360-log-events-such-as-adding-or-removing-an-ip-to-from-the-gray-list"><a href="#_3-does-imunify360-log-events-such-as-adding-or-removing-an-ip-to-from-the-gray-list" aria-hidden="true" class="header-anchor">#</a> 3. Does Imunify360 log events such as adding or removing an IP to/from the Gray List?</h3> <p>Most Imunify360 logs are saved in <span class="notranslate"><code>/var/log/imunify360/console.log</code></span>. For example, when IP is blocked and added to the <span class="notranslate">Black List</span>, the following lines are added:</p> <div class="notranslate"><div class="language-Python extra-class"><pre class="language-python"><code>INFO <span class="token punctuation">[</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span><span class="token number">889</span><span class="token punctuation">]</span>
defence360agent<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>protector<span class="token punctuation">.</span>lazy_init<span class="token punctuation">:</span> IP <span class="token number">103.86</span><span class="token number">.52</span><span class="token number">.175</span> <span class="token keyword">is</span> BLOCKED
<span class="token keyword">with</span> <span class="token number">300</span> sec <span class="token punctuation">(</span>expiration<span class="token punctuation">:</span> <span class="token number">1492281300</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>due to SensorAlert<span class="token punctuation">)</span>
INFO <span class="token punctuation">[</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span><span class="token number">889</span><span class="token punctuation">]</span>
defence360agent<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>protector<span class="token punctuation">.</span>lazy_init<span class="token punctuation">:</span> Unblocking <span class="token number">103.86</span><span class="token number">.52</span><span class="token number">.175</span> <span class="token keyword">in</span>
CSF <span class="token keyword">as</span> it <span class="token keyword">is</span> already <span class="token keyword">in</span> our graylist
INFO <span class="token punctuation">[</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">,</span><span class="token number">663</span><span class="token punctuation">]</span> defence360agent<span class="token punctuation">.</span>internals<span class="token punctuation">.</span>the_sink<span class="token punctuation">:</span>
SensorAlert<span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token string">'rule_id'</span><span class="token punctuation">:</span> <span class="token string">'LF_SMTPAUTH'</span><span class="token punctuation">,</span> <span class="token string">'timestamp'</span><span class="token punctuation">:</span> <span class="token number">1492281000.8720655</span><span class="token punctuation">,</span> <span class="token string">'attackers_ip'</span><span class="token punctuation">:</span> <span class="token string">'103.86.52.175'</span><span class="token punctuation">,</span> <span class="token string">'plugin_id'</span><span class="token punctuation">:</span> <span class="token string">'lfd'</span><span class="token punctuation">,</span> <span class="token string">'method'</span><span class="token punctuation">:</span> <span class="token string">'ALERT'</span><span class="token punctuation">,</span> <span class="token string">'ttl'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">}</span>
When user unblocks himself by captcha<span class="token punctuation">,</span> logs look like this<span class="token punctuation">:</span>
INFO <span class="token punctuation">[</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">956</span><span class="token punctuation">]</span> defence360agent<span class="token punctuation">.</span>internals<span class="token punctuation">.</span>the_sink<span class="token punctuation">:</span>
CaptchaEvent<span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token string">'timestamp'</span><span class="token punctuation">:</span> <span class="token number">1492404686.9496775</span><span class="token punctuation">,</span> <span class="token string">'errors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'user_agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36'</span><span class="token punctuation">,</span> <span class="token string">'accept_language'</span><span class="token punctuation">:</span> <span class="token string">'ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4'</span><span class="token punctuation">,</span> <span class="token string">'event'</span><span class="token punctuation">:</span> <span class="token string">'PASSED'</span><span class="token punctuation">,</span> <span class="token string">'method'</span><span class="token punctuation">:</span> <span class="token string">'CAPTCHA'</span><span class="token punctuation">,</span> <span class="token string">'attackers_ip'</span><span class="token punctuation">:</span> <span class="token string">'10.101.1.18'</span><span class="token punctuation">}</span>
INFO <span class="token punctuation">[</span><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">17</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">51</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">967</span><span class="token punctuation">]</span>
defence360agent<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>protector<span class="token punctuation">.</span>lazy_init<span class="token punctuation">:</span> IP <span class="token number">10.101</span><span class="token number">.1</span><span class="token number">.18</span> <span class="token keyword">is</span> UNBLOCKED
<span class="token punctuation">(</span>due to ClientUnblock<span class="token punctuation">)</span>
</code></pre></div></div> <p>Adding and removing IPs from the <span class="notranslate">White List</span> is only possible manually, no IPs will be added automatically.</p> <h3 id="_4-comodo-waf-has-a-lot-false-positive-and-trigger-the-csf-blocking-will-imunify360-improve-it"><a href="#_4-comodo-waf-has-a-lot-false-positive-and-trigger-the-csf-blocking-will-imunify360-improve-it" aria-hidden="true" class="header-anchor">#</a> 4. Comodo WAF has a lot false positive and trigger the CSF blocking, will Imunify360 improve it?</h3> <p>CSF only blocks IPs by <span class="notranslate">mod_security</span> if <span class="notranslate">mod_security</span> configured with <span class="notranslate"><code>SecRuleEngine On</code></span>. Imunify360 works a bit differently: it uses <span class="notranslate"><code>SecRuleEngine DetectionOnly</code></span> in <span class="notranslate">mod_security</span> configuration and only blocks by <span class="notranslate">mod_security</span> events with high severity, thus decreasing false positives rate.</p> <p>In some cases <span class="notranslate">mod_security</span> needs to be configured not to cause blocks by csf/lfd.</p> <p>Possible solutions are:</p> <ul><li><p>Set <span class="notranslate"><code>SecRuleEngine</code></span> to <span class="notranslate"><code>DetectionOnly</code></span> – this way CSF will not block IPs by <span class="notranslate">mod_security</span> events and Imunify360 will still block by <span class="notranslate">mod_security</span> events with high severity (preferable way).</p></li> <li><p>In <span class="notranslate"><code>/etc/csf/csf.conf</code></span> set <span class="notranslate"><code>LF_MODSEC</code></span> to <code>0</code> so that CSF will ignore <span class="notranslate">mod_security</span> events and Imunify360 will still block IPs as described above. But note that in this case requests causing <span class="notranslate">mod_security</span> events will still be blocked by <span class="notranslate">mod_security</span> itself.</p></li></ul> <h3 id="_5-to-start-using-imunify360-we-need-to-know-which-information-is-sent-to-your-servers-could-you-please-give-us-some-more-information"><a href="#_5-to-start-using-imunify360-we-need-to-know-which-information-is-sent-to-your-servers-could-you-please-give-us-some-more-information" aria-hidden="true" class="header-anchor">#</a> 5. To start using Imunify360 we need to know which information is sent to your servers. Could you please give us some more information?</h3> <p>The following info is sent to our server:</p> <ul><li>all the messages from IDS OSSEC (can be found in OSSEC logs)</li> <li>all the messages from <span class="notranslate">mod_security</span> (can be found in <span class="notranslate"><code>modsec_audit.log</code></span>)</li> <li>users domains (to be checked in reputation engine);</li> <li>CAPTCHA verification info</li> <li>all running scans for malware (maldet scans) and information on moving to the quarantine or discovering suspicious files</li> <li>optionally, suspicious files can be sent to us for the analysis. Files can be sent via UI by marking a proper checkbox</li></ul> <h3 id="_6-no-valid-imunify360-license-found"><a href="#_6-no-valid-imunify360-license-found" aria-hidden="true" class="header-anchor">#</a> 6. No valid Imunify360 License Found.</h3> <p>Check if the agent is running.</p> <p>Check access to the central server (<span class="notranslate"><code>IP: 148.251.130.176 port: 443)</code></span>.</p> <p>Call <span class="notranslate"><code>imunify360-agent rstatus</code></span> and ensure that status is <span class="notranslate"><code>True</code></span>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>{'expiration': 0, 'status': True, 'user_count': None, 'user_limit': None, 'redirect_url': None}
</code></pre></div></div> <p>Ensure that <span class="notranslate"><code>/etc/sysconfig/imunify360/imunify360.id</code></span> file contains <span class="notranslate"><code>server_id</code></span>.</p> <p>If no, <span class="notranslate"><code>imunify360-agent register KEY</code></span>.</p> <h3 id="_7-i-have-an-error-peewee-databaseerror-database-disk-image-is-malformed-what-should-i-do"><a href="#_7-i-have-an-error-peewee-databaseerror-database-disk-image-is-malformed-what-should-i-do" aria-hidden="true" class="header-anchor">#</a> 7. I have an error peewee.DatabaseError: database disk image is malformed. What should I do?</h3> <p>Imunify360 uses SQLite database to store its data. Although this database has proved its reliability, database files become corrupted in rare cases. To restore data try to perform the following steps:</p> <p>Stop the agent.</p> <p>If you have sqlite3 application installed on your machine, try to make dump of Imunify360 database:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#sqlite3 /var/imunify360/imunify360.db
.mode insert
.output dump_all.sql
.dump
.exit
</code></pre></div></div> <p>You should see new file <span class="notranslate"><code>dump_all.sql</code></span> in the directory <span class="notranslate"><code>/var/imunify/</code></span></p> <p>Create a new database from this dump file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#sqlite3 imunify360.db.new &lt; dump_all.sql
</code></pre></div></div> <p>Replace old database with the new one:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#cd /var/imunify/
#mv imunify360.db imunify360.db.corrupt &amp;&amp; mv imunify360.db.new imunify360.db
</code></pre></div></div> <p>Start the Imunify360 agent.</p> <p>If these steps have not solved the problem or no sqlite3 package is installed, then you should create a completely new database:</p> <p>Stop the agent.</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#rm /var/imunify/imunify360.db
#imunify360-agent migratedb
</code></pre></div></div> <p>Start the agent</p> <h3 id="_8-why-does-my-cpanel-with-litespeed-and-owasp-modsecurity-rule-set-trigger-500-error-on-all-web-pages-after-installing-imunify360"><a href="#_8-why-does-my-cpanel-with-litespeed-and-owasp-modsecurity-rule-set-trigger-500-error-on-all-web-pages-after-installing-imunify360" aria-hidden="true" class="header-anchor">#</a> 8. Why does my cPanel with LiteSpeed and OWASP ModSecurity rule set trigger 500 error on all web pages after installing Imunify360?</h3> <p>OWASP rule set may conflict with Imunify360 default rule set on a server running <span class="notranslate">LiteSpeed Web Server</span>. We recommend to turn off OWASP rule set prior to installing Imunify360.</p> <p>Please find more FAQs in our <a href="https://cloudlinux.zendesk.com/hc/sections/115001538929-FAQ" target="_blank" rel="noopener noreferrer">Knowledge Base<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="_9-disabling-waf-rules-for-certain-countries"><a href="#_9-disabling-waf-rules-for-certain-countries" aria-hidden="true" class="header-anchor">#</a> 9. Disabling WAF rules for certain countries.</h3> <p>It is possible to disable some WAF rules for IPs that are resolved to be from some country (or other geographical entity).
To implement this, a customer should create his own modsecurity configuration file, and include it into the default modsecurity configuration. In case of cPanel, this can be done by creating <span class="notranslate"><code>/etc/apache2/conf.d/includes/countrywafrules.conf</code></span> and adding it as an include to the <span class="notranslate"><code>/etc/apache2/conf.d/modsec/modsec2.cpanel.conf</code></span>. Otherwise configuration files might be rewritten by Imunify360 rules update.</p> <p>Example of contents of such config file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>SecGeoLookupDb /path/to/GeoLiteCity.dat 
# ModSecurity relies on the free geolocation databases (GeoLite City and GeoLite Country) that can be obtained from MaxMind http://www.maxmind.com. Currently ModSecurity only supports the legacy GeoIP format. Maxmind's newer GeoIP2 format is not yet currently supported.
So a customer need to download this IP database and locate somewhere.

# Lookup IP address 
SecRule REMOTE_ADDR &quot;@geoLookup&quot; &quot;phase:1,id:155,nolog,pass&quot;

# Optionally block IP address for which geolocation failed
# SecRule &amp;GEO &quot;@eq 0&quot; &quot;phase:1,id:156,deny,msg:'Failed to lookup IP'&quot;

# Skip rules 942100 and 942101 for GB country as example

SecRule GEO:COUNTRY_CODE &quot;@streq GB&quot; &quot;phase:2,auditlog,id:157,pass,severity:2,\
ctl:ruleRemoveById=942100,\
ctl:ruleRemoveById=942101&quot;
</code></pre></div></div> <p>Make sure that you have replaced <span class="notranslate"><code>/path/to/GeoLiteCity.dat</code></span> with the real path to the GeoLiteCity.dat file installed in your system.</p> <p>Variable <span class="notranslate"><code>GEO</code></span> is a collection populated by result of the last <span class="notranslate"><code>@geoLookup</code></span> operator. The collection can be used to match geographical fields looked from an IP address or hostname.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>Available since ModSecurity 2.5.0.</p></div> <p>Fields:</p> <ul><li><span class="notranslate"><code>COUNTRY_CODE</code></span>: two character country code. Example: <code>US</code>, <code>GB</code>, etc.</li> <li><span class="notranslate"><code>COUNTRY_CODE3</code></span>: up to three character country code.</li> <li><span class="notranslate"><code>COUNTRY_NAME</code></span>: full country name.</li> <li><span class="notranslate"><code>COUNTRY_CONTINENT</code></span>: two character continent that the country is located. Example: <code>EU</code>.</li> <li><span class="notranslate"><code>REGION</code></span>: two character region. For US, this is state. For Canada, providence, etc.</li> <li><span class="notranslate"><code>CITY</code></span>: city name if supported by the database.</li> <li><span class="notranslate"><code>POSTAL_CODE</code></span>: postal code if supported by the database.</li> <li><span class="notranslate"><code>LATITUDE</code></span>: latitude if supported by the database.</li> <li><span class="notranslate"><code>LONGITUDE</code></span>: longitude if supported by the database.</li> <li><span class="notranslate"><code>DMA_CODE</code></span>: metropolitan area code if supported by the database. (US only)</li> <li><span class="notranslate"><code>AREA_CODE</code></span>: phone system area code. (US only)</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/imunify360-doc/edit/dev/docs/faq_and_known_issues/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> </div> <div class="footer" data-v-20b89de8><div data-v-20b89de8><a href="https://cloudlinux.com" data-v-20b89de8><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-20b89de8></a></div> <div class="footer-company-title" data-v-20b89de8>2019. CloudLinux Inc</div> <div data-v-20b89de8><div data-v-20b89de8><a href="https://cloudlinux.zendesk.com/hc/sections/115001344329-How-do-I" target="_blank" data-v-20b89de8>How to</a></div><div data-v-20b89de8><a href="https://imunify360.com/getting-started" target="_blank" data-v-20b89de8>Getting started</a></div><div data-v-20b89de8><a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" data-v-20b89de8>Contact support</a></div><div data-v-20b89de8><a href="https://www.imunify360.com/blog" target="_blank" data-v-20b89de8>Blog</a></div></div> <div class="social" data-v-20b89de8><span class="footer-social-text" data-v-20b89de8>Stay in touch</span> <a href="https://www.facebook.com/imunify360/" target="_blank" data-v-20b89de8><img src="/fb.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://twitter.com/imunify360/" target="_blank" data-v-20b89de8><img src="/tw.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-20b89de8><img src="/in.png" class="footer-social-logo" data-v-20b89de8></a><a href="https://www.youtube.com/channel/UCcW6dDJjcy41c7Hl_5LdLZQ" target="_blank" data-v-20b89de8><img src="/ytube.png" class="footer-social-logo" data-v-20b89de8></a></div></div> <!----></div></div>
    <script src="/assets/js/app.bb2f7be1.js" defer></script><script src="/assets/js/10.bca94a56.js" defer></script>
  </body>
</html>
